<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="BethOptimizer - Advanced optimization tool for Bethesda games">
    <meta name="author" content="DarkPlayer84">
    <title>BethOptimizer v2.0 | DarkPlayer84</title>
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS Variables for theming */
        :root {
            --primary-color: #ff6b35;
            --secondary-color: #f7931e;
            --bg-dark: #0a0e1a;
            --bg-medium: #141824;
            --bg-light: #1e2436;
            --text-primary: #ffffff;
            --text-secondary: #b8c1d6;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            --gold: #d4af37;
            --border-color: rgba(255, 255, 255, 0.1);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Light theme */
        [data-theme="light"] {
            --bg-dark: #f3f4f6;
            --bg-medium: #ffffff;
            --bg-light: #ffffff;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --border-color: rgba(0, 0, 0, 0.1);
            --glass-bg: rgba(255, 255, 255, 0.8);
        }

        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            font-size: 16px;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            transition: var(--transition);
        }

        /* Animated background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 107, 53, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(247, 147, 30, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(212, 175, 55, 0.05) 0%, transparent 50%);
            animation: bgFloat 20s ease-in-out infinite;
        }

        @keyframes bgFloat {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-20px) scale(1.1); }
        }

        /* Particles */
        .particle {
            position: fixed;
            pointer-events: none;
            opacity: 0;
            z-index: 9999;
        }

        .particle.active {
            animation: particleFloat 3s ease-out forwards;
        }

        @keyframes particleFloat {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(0);
            }
            50% {
                opacity: 0.5;
                transform: translate(var(--tx), var(--ty)) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(calc(var(--tx) * 2), calc(var(--ty) * 2)) scale(0.5);
            }
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Glass card effect */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 1.5rem;
            transition: var(--transition);
        }

        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border-color: var(--primary-color);
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(255, 107, 53, 0.3);
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(255, 255, 255, 0.1),
                transparent
            );
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .logo {
            font-family: 'Cinzel', serif;
            font-size: 3rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            letter-spacing: 0.1em;
        }

        .version-badge {
            display: inline-block;
            background: rgba(0, 0, 0, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            font-size: 0.9rem;
            margin: 0.5rem;
        }

        /* Theme toggle */
        .theme-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
        }

        .theme-toggle button {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .theme-toggle button:hover {
            background: var(--primary-color);
            transform: rotate(180deg);
        }

        /* Navigation tabs */
        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 2rem;
            padding: 0.5rem;
            background: var(--glass-bg);
            border-radius: 1rem;
            backdrop-filter: blur(10px);
            overflow-x: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) transparent;
        }

        .tabs::-webkit-scrollbar {
            height: 6px;
        }

        .tabs::-webkit-scrollbar-track {
            background: transparent;
        }

        .tabs::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 3px;
        }

        .tab {
            flex: 1;
            min-width: 120px;
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: var(--transition);
            white-space: nowrap;
            position: relative;
            overflow: hidden;
        }

        .tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
            transition: left 0.5s;
        }

        .tab:hover::before {
            left: 100%;
        }

        .tab.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
        }

        /* Tab content */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Sections */
        .section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.75rem;
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            color: var(--text-primary);
            font-family: inherit;
            transition: var(--transition);
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }

        .btn-secondary {
            background: var(--glass-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
            border-color: var(--primary-color);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Progress bar */
        .progress {
            width: 100%;
            height: 30px;
            background: var(--glass-bg);
            border-radius: 1rem;
            overflow: hidden;
            margin: 1rem 0;
            border: 1px solid var(--border-color);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            width: 0%;
            transition: width 0.5s ease-out;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: progressShine 2s infinite;
        }

        @keyframes progressShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* Grid */
        .grid {
            display: grid;
            gap: 1.5rem;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        /* Game cards */
        .game-card {
            cursor: pointer;
            position: relative;
            overflow: hidden;
            padding: 1.5rem;
            transition: var(--transition);
        }

        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent, var(--primary-color));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .game-card:hover::before {
            opacity: 0.1;
        }

        .game-card.selected {
            border: 2px solid var(--primary-color);
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.3);
        }

        .game-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .game-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .game-info {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Status badges */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .badge-error {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
        }

        .badge-info {
            background: rgba(59, 130, 246, 0.2);
            color: var(--info);
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            min-width: 300px;
            padding: 1rem;
            background: var(--bg-medium);
            border-left: 4px solid var(--primary-color);
            border-radius: 0.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.success {
            border-left-color: var(--success);
        }

        .notification.warning {
            border-left-color: var(--warning);
        }

        .notification.error {
            border-left-color: var(--error);
        }

        /* DarkPlayer84 Branding */
        .darkplayer-logo {
            font-family: 'Cinzel', serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--gold);
            text-shadow: 
                2px 2px 4px rgba(0, 0, 0, 0.8),
                0 0 20px rgba(212, 175, 55, 0.5);
            letter-spacing: 0.15em;
            text-align: center;
            margin: 1rem 0;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1rem 0;
        }

        .social-link {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            color: var(--text-primary);
            text-decoration: none;
            transition: var(--transition);
        }

        .social-link:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
        }

        /* Loading spinner */
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--border-color);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .logo {
                font-size: 2rem;
            }

            .tabs {
                flex-direction: column;
            }

            .tab {
                width: 100%;
            }

            .grid-2 {
                grid-template-columns: 1fr;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-dark);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }

        /* Tooltip */
        .tooltip {
            position: relative;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-dark);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            white-space: nowrap;
            font-size: 0.875rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .tooltip:hover::after {
            opacity: 1;
        }

        /* Animations */
        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .shake {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body>
    <!-- Background animation -->
    <div class="bg-animation"></div>

    <!-- Theme toggle -->
    <div class="theme-toggle">
        <button onclick="toggleTheme()" aria-label="Toggle theme">
            <span id="theme-icon">🌙</span>
        </button>
    </div>

    <!-- Main container -->
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="logo">BETHOPTIMIZER</h1>
                <div style="text-align: center;">
                    <span class="version-badge">v2.0 Enhanced</span>
                    <span class="version-badge">Build 100</span>
                    <span class="version-badge">Stable Release</span>
                </div>
                <p style="text-align: center; margin-top: 1rem; opacity: 0.9;">
                    Advanced Optimization Suite for Bethesda Games
                </p>
                <div class="darkplayer-logo">DARKPLAYER84</div>
                <div class="social-links">
                    <a href="https://youtube.com/@darkplayer84" target="_blank" class="social-link" aria-label="YouTube">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                        </svg>
                    </a>
                    <a href="https://github.com/darkplayer84" target="_blank" class="social-link" aria-label="GitHub">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                        </svg>
                    </a>
                    <a href="https://twitch.tv/darkplayer84" target="_blank" class="social-link" aria-label="Twitch">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M11.571 4.714h1.715v5.143H11.57zm4.715 0H18v5.143h-1.714zM6 0L1.714 4.286v15.428h5.143V24l4.286-4.286h3.428L22.286 12V0zm14.571 11.143l-3.428 3.428h-3.429l-3 3v-3H6.857V1.714h13.714Z"/>
                        </svg>
                    </a>
                    <a href="https://twitter.com/darkplayer84" target="_blank" class="social-link" aria-label="Twitter">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                        </svg>
                    </a>
                </div>
            </div>
        </header>

        <!-- Navigation tabs -->
        <nav class="tabs" role="navigation">
            <button class="tab active" onclick="showTab('dashboard')">
                <span>📊 Dashboard</span>
            </button>
            <button class="tab" onclick="showTab('games')">
                <span>🎮 Games</span>
            </button>
            <button class="tab" onclick="showTab('hardware')">
                <span>🖥️ Hardware</span>
            </button>
            <button class="tab" onclick="showTab('graphics')">
                <span>🎨 Graphics</span>
            </button>
            <button class="tab" onclick="showTab('performance')">
                <span>⚡ Performance</span>
            </button>
            <button class="tab" onclick="showTab('mods')">
                <span>🔧 Mods</span>
            </button>
            <button class="tab" onclick="showTab('tools')">
                <span>🛠️ Tools</span>
            </button>
            <button class="tab" onclick="showTab('settings')">
                <span>⚙️ Settings</span>
            </button>
        </nav>

        <!-- Tab Contents -->
        <!-- Dashboard -->
        <div id="dashboard" class="tab-content active">
            <div class="section">
                <h2 class="section-title">
                    <span>📊</span>
                    <span>System Overview</span>
                </h2>
                
                <div class="grid grid-2">
                    <div class="glass-card">
                        <h3 style="margin-bottom: 1rem;">Quick Actions</h3>
                        <div style="display: flex; flex-direction: column; gap: 1rem;">
                            <button class="btn btn-primary" onclick="quickScan()">
                                <span>🔍</span>
                                <span>Quick Scan</span>
                            </button>
                            <button class="btn btn-secondary" onclick="autoOptimize()">
                                <span>⚡</span>
                                <span>Auto-Optimize</span>
                            </button>
                            <button class="btn btn-secondary" onclick="backupSettings()">
                                <span>💾</span>
                                <span>Backup Settings</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="glass-card">
                        <h3 style="margin-bottom: 1rem;">System Status</h3>
                        <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>CPU Usage</span>
                                <span class="badge badge-success" id="cpu-usage">12%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>GPU Usage</span>
                                <span class="badge badge-success" id="gpu-usage">45%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>RAM Usage</span>
                                <span class="badge badge-warning" id="ram-usage">68%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Temperature</span>
                                <span class="badge badge-success" id="temp">52°C</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="glass-card" style="margin-top: 1.5rem;">
                    <h3 style="margin-bottom: 1rem;">Performance Metrics</h3>
                    <canvas id="perfChart" height="100"></canvas>
                </div>
            </div>
        </div>

        <!-- Games -->
        <div id="games" class="tab-content">
            <div class="section">
                <h2 class="section-title">
                    <span>🎮</span>
                    <span>Select Game to Optimize</span>
                </h2>
                
                <div class="grid grid-2">
                    <div class="glass-card game-card" onclick="selectGame('skyrim')" id="game-skyrim">
                        <div class="game-icon">🏔️</div>
                        <h3 class="game-title">Skyrim Anniversary Edition</h3>
                        <div class="game-info">
                            <p>Engine: Creation Engine</p>
                            <p>SKSE: <span class="badge badge-success">v2.2.6</span></p>
                            <p>Status: <span class="badge badge-info">Ready</span></p>
                        </div>
                    </div>
                    
                    <div class="glass-card game-card" onclick="selectGame('fallout4')" id="game-fallout4">
                        <div class="game-icon">☢️</div>
                        <h3 class="game-title">Fallout 4</h3>
                        <div class="game-info">
                            <p>Engine: Creation Engine</p>
                            <p>F4SE: <span class="badge badge-success">v0.6.23</span></p>
                            <p>Status: <span class="badge badge-info">Ready</span></p>
                        </div>
                    </div>
                    
                    <div class="glass-card game-card" onclick="selectGame('starfield')" id="game-starfield">
                        <div class="game-icon">🌌</div>
                        <h3 class="game-title">Starfield</h3>
                        <div class="game-info">
                            <p>Engine: Creation Engine 2</p>
                            <p>SFSE: <span class="badge badge-warning">v0.2.5</span></p>
                            <p>Status: <span class="badge badge-info">Ready</span></p>
                        </div>
                    </div>
                    
                    <div class="glass-card game-card" onclick="selectGame('fallout76')" id="game-fallout76">
                        <div class="game-icon">🏚️</div>
                        <h3 class="game-title">Fallout 76</h3>
                        <div class="game-info">
                            <p>Engine: Creation Engine</p>
                            <p>Online: <span class="badge badge-success">Active</span></p>
                            <p>Status: <span class="badge badge-info">Ready</span></p>
                        </div>
                    </div>
                </div>
                
                <div class="glass-card" style="margin-top: 1.5rem;">
                    <h3 style="margin-bottom: 1rem;">Selected Game Configuration</h3>
                    <div id="selected-game-info">
                        <p style="text-align: center; color: var(--text-secondary);">No game selected</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hardware -->
        <div id="hardware" class="tab-content">
            <div class="section">
                <h2 class="section-title">
                    <span>🖥️</span>
                    <span>Hardware Analysis</span>
                </h2>
                
                <div class="glass-card">
                    <button class="btn btn-primary" onclick="scanHardware()" style="width: 100%; justify-content: center;">
                        <span>🔍</span>
                        <span>Start Hardware Scan</span>
                    </button>
                    
                    <div class="progress" id="scan-progress" style="display: none;">
                        <div class="progress-bar" id="scan-progress-bar">0%</div>
                    </div>
                </div>
                
                <div class="grid grid-2" style="margin-top: 1.5rem;">
                    <div class="glass-card">
                        <h3 style="margin-bottom: 1rem;">CPU Information</h3>
                        <div id="cpu-info">
                            <p>Model: <span id="cpu-model">Not scanned</span></p>
                            <p>Cores: <span id="cpu-cores">-</span></p>
                            <p>Speed: <span id="cpu-speed">-</span></p>
                            <p>Score: <span id="cpu-score">-</span></p>
                        </div>
                    </div>
                    
                    <div class="glass-card">
                        <h3 style="margin-bottom: 1rem;">GPU Information</h3>
                        <div id="gpu-info">
                            <p>Model: <span id="gpu-model">Not scanned</span></p>
                            <p>VRAM: <span id="gpu-vram">-</span></p>
                            <p>Driver: <span id="gpu-driver">-</span></p>
                            <p>Score: <span id="gpu-score">-</span></p>
                        </div>
                    </div>
                </div>
                
                <div class="glass-card" style="margin-top: 1.5rem;">
                    <h3 style="margin-bottom: 1rem;">Optimization Recommendations</h3>
                    <div id="recommendations">
                        <p style="text-align: center; color: var(--text-secondary);">Scan hardware to get recommendations</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Graphics -->
        <div id="graphics" class="tab-content">
            <div class="section">
                <h2 class="section-title">
                    <span>🎨</span>
                    <span>Graphics Settings</span>
                </h2>
                
                <div class="glass-card">
                    <div class="form-group">
                        <label class="form-label">Resolution</label>
                        <select class="form-select" id="resolution">
                            <option value="1920x1080">1920x1080 (Full HD)</option>
                            <option value="2560x1440">2560x1440 (2K)</option>
                            <option value="3840x2160">3840x2160 (4K)</option>
                            <option value="7680x4320">7680x4320 (8K)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Graphics Preset</label>
                        <select class="form-select" id="graphics-preset" onchange="updateGraphicsPreset()">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="ultra">Ultra</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Anti-Aliasing</label>
                        <select class="form-select" id="antialiasing">
                            <option value="off">Off</option>
                            <option value="fxaa">FXAA</option>
                            <option value="taa">TAA</option>
                            <option value="msaa2x">MSAA 2x</option>
                            <option value="msaa4x">MSAA 4x</option>
                            <option value="msaa8x">MSAA 8x</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Upscaling</label>
                        <select class="form-select" id="upscaling">
                            <option value="off">Off</option>
                            <option value="dlss-quality">DLSS Quality</option>
                            <option value="dlss-balanced">DLSS Balanced</option>
                            <option value="dlss-performance">DLSS Performance</option>
                            <option value="fsr-quality">FSR Quality</option>
                            <option value="fsr-balanced">FSR Balanced</option>
                            <option value="fsr-performance">FSR Performance</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance -->
        <div id="performance" class="tab-content">
            <div class="section">
                <h2 class="section-title">
                    <span>⚡</span>
                    <span>Performance Optimization</span>
                </h2>
                
                <div class="glass-card">
                    <h3 style="margin-bottom: 1rem;">Quick Presets</h3>
                    <div class="grid grid-2" style="gap: 1rem;">
                        <button class="btn btn-secondary" onclick="applyPreset('fps')">
                            <span>🎯</span>
                            <span>Max FPS</span>
                        </button>
                        <button class="btn btn-secondary" onclick="applyPreset('quality')">
                            <span>✨</span>
                            <span>Max Quality</span>
                        </button>
                        <button class="btn btn-secondary" onclick="applyPreset('balanced')">
                            <span>⚖️</span>
                            <span>Balanced</span>
                        </button>
                        <button class="btn btn-secondary" onclick="applyPreset('battery')">
                            <span>🔋</span>
                            <span>Battery Saver</span>
                        </button>
                    </div>
                </div>
                
                <div class="glass-card" style="margin-top: 1.5rem;">
                    <h3 style="margin-bottom: 1rem;">Advanced Settings</h3>
                    
                    <div class="form-group">
                        <label class="form-label">CPU Priority</label>
                        <select class="form-select" id="cpu-priority">
                            <option value="normal">Normal</option>
                            <option value="high">High</option>
                            <option value="realtime">Realtime</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">GPU Scheduling</label>
                        <select class="form-select" id="gpu-scheduling">
                            <option value="default">Default</option>
                            <option value="hardware">Hardware Accelerated</option>
                            <option value="optimized">Optimized</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Memory Allocation (GB)</label>
                        <input type="range" class="form-input" id="memory-allocation" 
                               min="2" max="32" value="8" 
                               oninput="document.getElementById('memory-value').textContent = this.value + ' GB'">
                        <span id="memory-value">8 GB</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mods -->
        <div id="mods" class="tab-content">
            <div class="section">
                <h2 class="section-title">
                    <span>🔧</span>
                    <span>Mod Management</span>
                </h2>
                
                <div class="glass-card">
                    <h3 style="margin-bottom: 1rem;">Essential Mods</h3>
                    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="mod-unofficial-patch" checked>
                            <span>Unofficial Patch</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="mod-engine-fixes">
                            <span>Engine Fixes</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="mod-display-tweaks">
                            <span>Display Tweaks</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="mod-performance">
                            <span>Performance Optimizations</span>
                        </label>
                    </div>
                </div>
                
                <div class="glass-card" style="margin-top: 1.5rem;">
                    <h3 style="margin-bottom: 1rem;">Load Order</h3>
                    <div id="load-order">
                        <p style="text-align: center; color: var(--text-secondary);">No mods detected</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tools -->
        <div id="tools" class="tab-content">
            <div class="section">
                <h2 class="section-title">
                    <span>🛠️</span>
                    <span>System Tools</span>
                </h2>
                
                <div class="grid grid-2">
                    <div class="glass-card">
                        <h3 style="margin-bottom: 1rem;">Maintenance</h3>
                        <button class="btn btn-secondary" onclick="cleanCache()" style="width: 100%; margin-bottom: 0.5rem;">
                            <span>🧹</span>
                            <span>Clean Cache</span>
                        </button>
                        <button class="btn btn-secondary" onclick="verifyFiles()" style="width: 100%; margin-bottom: 0.5rem;">
                            <span>✅</span>
                            <span>Verify Game Files</span>
                        </button>
                        <button class="btn btn-secondary" onclick="defragment()" style="width: 100%;">
                            <span>💾</span>
                            <span>Defragment</span>
                        </button>
                    </div>
                    
                    <div class="glass-card">
                        <h3 style="margin-bottom: 1rem;">Backup & Restore</h3>
                        <button class="btn btn-secondary" onclick="createBackup()" style="width: 100%; margin-bottom: 0.5rem;">
                            <span>💾</span>
                            <span>Create Backup</span>
                        </button>
                        <button class="btn btn-secondary" onclick="restoreBackup()" style="width: 100%; margin-bottom: 0.5rem;">
                            <span>📂</span>
                            <span>Restore Backup</span>
                        </button>
                        <button class="btn btn-secondary" onclick="exportConfig()" style="width: 100%;">
                            <span>📤</span>
                            <span>Export Config</span>
                        </button>
                    </div>
                </div>
                
                <div class="glass-card" style="margin-top: 1.5rem;">
                    <h3 style="margin-bottom: 1rem;">Benchmark</h3>
                    <button class="btn btn-primary" onclick="runBenchmark()" style="width: 100%;">
                        <span>📊</span>
                        <span>Run Performance Benchmark</span>
                    </button>
                    <div id="benchmark-results" style="margin-top: 1rem;"></div>
                </div>
            </div>
        </div>

        <!-- Settings -->
        <div id="settings" class="tab-content">
            <div class="section">
                <h2 class="section-title">
                    <span>⚙️</span>
                    <span>Application Settings</span>
                </h2>
                
                <div class="glass-card">
                    <h3 style="margin-bottom: 1rem;">General</h3>
                    
                    <div class="form-group">
                        <label class="form-label">Language</label>
                        <select class="form-select" id="language">
                            <option value="en">English</option>
                            <option value="it">Italiano</option>
                            <option value="es">Español</option>
                            <option value="fr">Français</option>
                            <option value="de">Deutsch</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="auto-update" checked>
                            <span>Enable auto-updates</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="analytics">
                            <span>Share anonymous usage data</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="notifications" checked>
                            <span>Enable notifications</span>
                        </label>
                    </div>
                </div>
                
                <div class="glass-card" style="margin-top: 1.5rem;">
                    <h3 style="margin-bottom: 1rem;">About</h3>
                    <div style="text-align: center;">
                        <div class="darkplayer-logo">DARKPLAYER84</div>
                        <p style="margin: 1rem 0;">BethOptimizer v2.0</p>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">
                            Advanced optimization suite for Bethesda games.<br>
                            Created with passion for the gaming community.
                        </p>
                        <div class="social-links" style="margin-top: 1rem;">
                            <a href="mailto:darkplayer84@gmail.com" class="btn btn-secondary">
                                <span>📧</span>
                                <span>Contact</span>
                            </a>
                            <a href="https://github.com/darkplayer84/BethesdaOptimizer" target="_blank" class="btn btn-secondary">
                                <span>📝</span>
                                <span>Source Code</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State management
        let currentTheme = 'dark';
        let selectedGame = null;
        let scanProgress = 0;
        let isScanning = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('BethOptimizer v2.0 initialized');
            initializeApp();
            createParticles();
            updateSystemStatus();
            drawPerformanceChart();
        });

        // Initialize app
        function initializeApp() {
            // Check localStorage for saved settings
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                currentTheme = savedTheme;
                applyTheme(savedTheme);
            }
            
            // Update status periodically
            setInterval(updateSystemStatus, 3000);
        }

        // Theme management
        function toggleTheme() {
            currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
            applyTheme(currentTheme);
            localStorage.setItem('theme', currentTheme);
        }

        function applyTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            document.getElementById('theme-icon').textContent = theme === 'dark' ? '🌙' : '☀️';
        }

        // Tab navigation
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab button
            event.target.closest('.tab').classList.add('active');
        }

        // Particle effects
        function createParticles() {
            document.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    createParticle(e.clientX, e.clientY);
                }
            });
        }

        function createParticle(x, y) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = x + 'px';
            particle.style.top = y + 'px';
            particle.style.width = '10px';
            particle.style.height = '10px';
            particle.style.background = 'var(--primary-color)';
            particle.style.borderRadius = '50%';
            particle.style.setProperty('--tx', (Math.random() - 0.5) * 100 + 'px');
            particle.style.setProperty('--ty', (Math.random() - 0.5) * 100 + 'px');
            
            document.body.appendChild(particle);
            
            requestAnimationFrame(() => {
                particle.classList.add('active');
            });
            
            setTimeout(() => {
                particle.remove();
            }, 3000);
        }

        // Notifications
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }

        // System status updates
        function updateSystemStatus() {
            // Simulate system metrics
            document.getElementById('cpu-usage').textContent = Math.floor(Math.random() * 50 + 10) + '%';
            document.getElementById('gpu-usage').textContent = Math.floor(Math.random() * 70 + 20) + '%';
            document.getElementById('ram-usage').textContent = Math.floor(Math.random() * 40 + 50) + '%';
            document.getElementById('temp').textContent = Math.floor(Math.random() * 20 + 50) + '°C';
            
            // Update badge colors based on values
            updateBadgeColors();
        }

        function updateBadgeColors() {
            const cpuUsage = parseInt(document.getElementById('cpu-usage').textContent);
            const cpuBadge = document.getElementById('cpu-usage');
            
            if (cpuUsage < 50) {
                cpuBadge.className = 'badge badge-success';
            } else if (cpuUsage < 80) {
                cpuBadge.className = 'badge badge-warning';
            } else {
                cpuBadge.className = 'badge badge-error';
            }
        }

        // Performance chart
        function drawPerformanceChart() {
            const canvas = document.getElementById('perfChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = 100;
            
            // Simple line chart simulation
            ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--primary-color');
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            for (let i = 0; i < width; i += 10) {
                const y = height / 2 + Math.sin(i * 0.05) * 30 + Math.random() * 10;
                if (i === 0) {
                    ctx.moveTo(i, y);
                } else {
                    ctx.lineTo(i, y);
                }
            }
            
            ctx.stroke();
        }

        // Game selection
        function selectGame(gameId) {
            // Remove previous selection
            document.querySelectorAll('.game-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selection to clicked game
            document.getElementById(`game-${gameId}`).classList.add('selected');
            selectedGame = gameId;
            
            // Update selected game info
            const gameInfo = {
                skyrim: {
                    name: 'Skyrim Anniversary Edition',
                    path: 'C:\\Program Files\\Steam\\steamapps\\common\\Skyrim Special Edition',
                    mods: 127,
                    lastPlayed: '2 hours ago'
                },
                fallout4: {
                    name: 'Fallout 4',
                    path: 'C:\\Program Files\\Steam\\steamapps\\common\\Fallout 4',
                    mods: 89,
                    lastPlayed: '3 days ago'
                },
                starfield: {
                    name: 'Starfield',
                    path: 'C:\\Program Files\\Steam\\steamapps\\common\\Starfield',
                    mods: 45,
                    lastPlayed: 'Yesterday'
                },
                fallout76: {
                    name: 'Fallout 76',
                    path: 'C:\\Program Files\\Bethesda.net Launcher\\games\\Fallout76',
                    mods: 0,
                    lastPlayed: '1 week ago'
                }
            };
            
            const info = gameInfo[gameId];
            document.getElementById('selected-game-info').innerHTML = `
                <p><strong>Game:</strong> ${info.name}</p>
                <p><strong>Path:</strong> ${info.path}</p>
                <p><strong>Active Mods:</strong> ${info.mods}</p>
                <p><strong>Last Played:</strong> ${info.lastPlayed}</p>
                <button class="btn btn-primary" style="margin-top: 1rem;" onclick="optimizeGame('${gameId}')">
                    <span>🚀</span>
                    <span>Optimize ${info.name}</span>
                </button>
            `;
            
            showNotification(`Selected: ${info.name}`, 'success');
        }

        // Hardware scanning
        async function scanHardware() {
            if (isScanning) return;
            
            isScanning = true;
            const progressBar = document.getElementById('scan-progress');
            const progressBarFill = document.getElementById('scan-progress-bar');
            
            progressBar.style.display = 'block';
            
            // Simulate scanning
            for (let i = 0; i <= 100; i += 5) {
                await sleep(100);
                progressBarFill.style.width = i + '%';
                progressBarFill.textContent = i + '%';
            }
            
            // Update hardware info
            document.getElementById('cpu-model').textContent = 'AMD Ryzen 7 5800X';
            document.getElementById('cpu-cores').textContent = '8 cores / 16 threads';
            document.getElementById('cpu-speed').textContent = '3.8 GHz (4.7 GHz boost)';
            document.getElementById('cpu-score').textContent = '95/100';
            
            document.getElementById('gpu-model').textContent = 'NVIDIA GeForce RTX 3080';
            document.getElementById('gpu-vram').textContent = '10 GB GDDR6X';
            document.getElementById('gpu-driver').textContent = '537.42';
            document.getElementById('gpu-score').textContent = '92/100';
            
            // Update recommendations
            document.getElementById('recommendations').innerHTML = `
                <div class="badge badge-success">Your system is optimized for Ultra settings</div>
                <ul style="margin-top: 1rem; padding-left: 1.5rem;">
                    <li>Enable Ray Tracing for enhanced visuals</li>
                    <li>Use DLSS Quality mode for best performance/quality balance</li>
                    <li>Recommended VRAM allocation: 8GB</li>
                    <li>Enable Hardware-Accelerated GPU Scheduling</li>
                </ul>
            `;
            
            progressBar.style.display = 'none';
            isScanning = false;
            showNotification('Hardware scan completed successfully!', 'success');
        }

        // Quick actions
        function quickScan() {
            showNotification('Starting quick system scan...', 'info');
            setTimeout(() => {
                showNotification('Quick scan completed! No issues found.', 'success');
            }, 2000);
        }

        function autoOptimize() {
            if (!selectedGame) {
                showNotification('Please select a game first', 'warning');
                return;
            }
            
            showNotification('Auto-optimization in progress...', 'info');
            setTimeout(() => {
                showNotification('Optimization completed successfully!', 'success');
            }, 3000);
        }

        function backupSettings() {
            showNotification('Creating backup...', 'info');
            setTimeout(() => {
                const backup = {
                    date: new Date().toISOString(),
                    version: '2.0',
                    settings: getAllSettings()
                };
                
                const blob = new Blob([JSON.stringify(backup, null, 2)], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `bethoptimizer_backup_${Date.now()}.json`;
                a.click();
                
                showNotification('Backup created successfully!', 'success');
            }, 1000);
        }

        // Game optimization
        async function optimizeGame(gameId) {
            showNotification(`Optimizing ${gameId}...`, 'info');
            
            // Simulate optimization process
            for (let i = 0; i < 5; i++) {
                await sleep(1000);
                showNotification(`Optimizing... ${(i + 1) * 20}%`, 'info');
            }
            
            showNotification(`${gameId} optimized successfully!`, 'success');
        }

        // Graphics presets
        function updateGraphicsPreset() {
            const preset = document.getElementById('graphics-preset').value;
            const presets = {
                low: { resolution: '1920x1080', aa: 'off', upscaling: 'fsr-performance' },
                medium: { resolution: '1920x1080', aa: 'fxaa', upscaling: 'fsr-balanced' },
                high: { resolution: '2560x1440', aa: 'taa', upscaling: 'dlss-balanced' },
                ultra: { resolution: '3840x2160', aa: 'msaa4x', upscaling: 'dlss-quality' }
            };
            
            if (preset !== 'custom') {
                const settings = presets[preset];
                document.getElementById('resolution').value = settings.resolution;
                document.getElementById('antialiasing').value = settings.aa;
                document.getElementById('upscaling').value = settings.upscaling;
                
                showNotification(`Applied ${preset} graphics preset`, 'success');
            }
        }

        // Performance presets
        function applyPreset(preset) {
            const presets = {
                fps: 'Maximum FPS configuration applied',
                quality: 'Maximum quality configuration applied',
                balanced: 'Balanced configuration applied',
                battery: 'Battery saver configuration applied'
            };
            
            showNotification(presets[preset], 'success');
        }

        // Tools functions
        function cleanCache() {
            showNotification('Cleaning cache...', 'info');
            setTimeout(() => {
                showNotification('Cache cleaned! Freed 2.3 GB', 'success');
            }, 2000);
        }

        function verifyFiles() {
            if (!selectedGame) {
                showNotification('Please select a game first', 'warning');
                return;
            }
            
            showNotification('Verifying game files...', 'info');
            setTimeout(() => {
                showNotification('All files verified successfully!', 'success');
            }, 3000);
        }

        function defragment() {
            showNotification('Starting defragmentation...', 'info');
            setTimeout(() => {
                showNotification('Defragmentation completed!', 'success');
            }, 4000);
        }

        function createBackup() {
            backupSettings();
        }

        function restoreBackup() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const backup = JSON.parse(event.target.result);
                            restoreSettings(backup.settings);
                            showNotification('Backup restored successfully!', 'success');
                        } catch (error) {
                            showNotification('Failed to restore backup', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function exportConfig() {
            const config = getAllSettings();
            const blob = new Blob([JSON.stringify(config, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bethoptimizer_config_${Date.now()}.json`;
            a.click();
            
            showNotification('Configuration exported!', 'success');
        }

        async function runBenchmark() {
            const resultsDiv = document.getElementById('benchmark-results');
            resultsDiv.innerHTML = '<div class="spinner"></div>';
            
            showNotification('Running benchmark...', 'info');
            
            await sleep(5000);
            
            resultsDiv.innerHTML = `
                <div class="glass-card">
                    <h4>Benchmark Results</h4>
                    <p>CPU Score: <span class="badge badge-success">8,742</span></p>
                    <p>GPU Score: <span class="badge badge-success">12,456</span></p>
                    <p>Memory Score: <span class="badge badge-warning">6,234</span></p>
                    <p>Storage Score: <span class="badge badge-success">9,876</span></p>
                    <p><strong>Overall Score: <span class="badge badge-success">37,308</span></strong></p>
                </div>
            `;
            
            showNotification('Benchmark completed!', 'success');
        }

        // Helper functions
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function getAllSettings() {
            return {
                theme: currentTheme,
                selectedGame: selectedGame,
                graphics: {
                    resolution: document.getElementById('resolution')?.value,
                    preset: document.getElementById('graphics-preset')?.value,
                    antialiasing: document.getElementById('antialiasing')?.value,
                    upscaling: document.getElementById('upscaling')?.value
                },
                performance: {
                    cpuPriority: document.getElementById('cpu-priority')?.value,
                    gpuScheduling: document.getElementById('gpu-scheduling')?.value,
                    memoryAllocation: document.getElementById('memory-allocation')?.value
                },
                general: {
                    language: document.getElementById('language')?.value,
                    autoUpdate: document.getElementById('auto-update')?.checked,
                    analytics: document.getElementById('analytics')?.checked,
                    notifications: document.getElementById('notifications')?.checked
                }
            };
        }

        function restoreSettings(settings) {
            if (settings.theme) {
                currentTheme = settings.theme;
                applyTheme(settings.theme);
            }
            
            if (settings.selectedGame) {
                selectGame(settings.selectedGame);
            }
            
            // Restore other settings
            if (settings.graphics) {
                if (document.getElementById('resolution')) {
                    document.getElementById('resolution').value = settings.graphics.resolution || '1920x1080';
                }
                // ... restore other graphics settings
            }
            
            // ... restore other categories
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl+S - Save/Export
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                exportConfig();
            }
            
            // Ctrl+O - Optimize
            if (e.ctrlKey && e.key === 'o') {
                e.preventDefault();
                if (selectedGame) {
                    optimizeGame(selectedGame);
                }
            }
            
            // Ctrl+B - Backup
            if (e.ctrlKey && e.key === 'b') {
                e.preventDefault();
                backupSettings();
            }
            
            // Ctrl+T - Toggle theme
            if (e.ctrlKey && e.key === 't') {
                e.preventDefault();
                toggleTheme();
            }
        });

        // Check for updates
        async function checkForUpdates() {
            try {
                // In a real app, this would check a server
                console.log('Checking for updates...');
                
                // Simulate update check
                await sleep(1000);
                
                const hasUpdate = Math.random() > 0.7;
                if (hasUpdate) {
                    showNotification('New update available! v2.1', 'info');
                }
            } catch (error) {
                console.error('Update check failed:', error);
            }
        }

        // Performance monitoring
        function startPerformanceMonitoring() {
            if (window.performance && window.performance.memory) {
                setInterval(() => {
                    const memoryUsage = (window.performance.memory.usedJSHeapSize / window.performance.memory.jsHeapSizeLimit) * 100;
                    console.log(`Memory usage: ${memoryUsage.toFixed(2)}%`);
                }, 5000);
            }
        }

        // Error handling
        window.addEventListener('error', (e) => {
            console.error('Global error:', e);
            showNotification('An error occurred. Check console for details.', 'error');
        });

        window.addEventListener('unhandledrejection', (e) => {
            console.error('Unhandled promise rejection:', e);
            showNotification('An error occurred. Check console for details.', 'error');
        });

        // Initialize monitoring
        startPerformanceMonitoring();
        
        // Check for updates on startup
        setTimeout(checkForUpdates, 3000);

        // Add smooth scroll
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        // Add loading animation on page load
        window.addEventListener('load', () => {
            document.body.style.opacity = '0';
            setTimeout(() => {
                document.body.style.transition = 'opacity 0.5s';
                document.body.style.opacity = '1';
            }, 100);
        });

        // Console welcome message
        console.log('%c🎮 BethOptimizer v2.0', 'font-size: 24px; color: #ff6b35; font-weight: bold;');
        console.log('%cCreated by DarkPlayer84', 'font-size: 14px; color: #d4af37;');
        console.log('%cGitHub: https://github.com/darkplayer84/BethesdaOptimizer', 'font-size: 12px; color: #888;');
    </script>

<style>
/* --- EULA Overlay (lightweight) --- */
.bo-overlay{position:fixed;inset:0;background:rgba(10,14,26,.9);display:flex;align-items:center;justify-content:center;z-index:9999}
.bo-card{width:min(960px,92vw);max-height:min(85vh,940px);background:var(--bg-medium);border:1px solid var(--border-color);border-radius:1rem;overflow:hidden;display:flex;flex-direction:column}
.bo-card-h{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--border-color)}
.bo-card-b{padding:12px 16px;overflow:auto}
.bo-x{background:transparent;border:1px solid var(--border-color);border-radius:.5rem;color:var(--text-primary);cursor:pointer;padding:.25rem .5rem}
.bo-hint{color:var(--text-secondary);font-size:.9rem}
.bo-pill{display:inline-block;padding:.25rem .5rem;border-radius:1rem;background:rgba(255,255,255,.08);color:var(--text-primary);font-weight:600}
/* --- Downloads Tab small tweaks --- */
.bo-row{display:flex;gap:.5rem;flex-wrap:wrap}
.bo-list{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:.5rem}
</style>

<script>
(function(){
  const CHANNELS = {
    yt:  "https://www.youtube.com/@DarkPlayer84TvProductions",
    gh:  "https://github.com/darkplayer84",
    twc: "https://twitch.tv/darkplayer84tv",
    twt: "https://twitter.com/oldgamerdarthy",
    mail:"mailto:darkplayer84tvlive@outlook.com"
  };

  document.addEventListener('DOMContentLoaded', () => {
    // 1) Update version badge (first one) to v2.3.1
    const vb = document.querySelectorAll('.version-badge');
    if (vb && vb.length) { vb[0].textContent = 'v2.3.1'; }

    // 2) Fix social links (header icons + about buttons)
    const yt = document.querySelector('a[aria-label="YouTube"]'); if(yt) yt.href = CHANNELS.yt;
    const gh = document.querySelector('a[aria-label="GitHub"]');  if(gh) gh.href = CHANNELS.gh;
    const tw = document.querySelector('a[aria-label="Twitch"]');  if(tw) tw.href = CHANNELS.twc;
    const tx = document.querySelector('a[aria-label="Twitter"]'); if(tx) tx.href = CHANNELS.twt;
    const contactBtn = Array.from(document.querySelectorAll('a[href^="mailto:"]'))[0];
    if (contactBtn) contactBtn.href = CHANNELS.mail;
    const srcBtn = Array.from(document.querySelectorAll('a[href*="github.com"]')).find(a => /Source Code/i.test(a.textContent||''));
    if (srcBtn) srcBtn.href = CHANNELS.gh;

    // 3) Inject Downloads Tab button + content
    const tabs = document.querySelector('.tabs');
    if (tabs && !document.getElementById('downloads')){
      const downloadsBtn = document.createElement('button');
      downloadsBtn.className = 'tab';
      downloadsBtn.innerHTML = '<span>⬇️</span><span> Downloads</span>';
      tabs.appendChild(downloadsBtn);

      const downloadsContent = document.createElement('div');
      downloadsContent.id = 'downloads';
      downloadsContent.className = 'tab-content';
      downloadsContent.innerHTML = `
        <div class="section">
          <h2 class="section-title"><span>⬇️</span><span>Download Area</span></h2>
          <div class="glass-card">
            <div class="bo-row" style="margin-bottom:.5rem">
              <button class="btn btn-secondary" id="bo-clear">Svuota</button>
              <button class="btn btn-primary" id="bo-export">Esporta ZIP</button>
            </div>
            <ul id="bo-list" class="bo-list"></ul>
          </div>
        </div>`;
      // Append after last tab-content
      document.querySelector('.container').appendChild(downloadsContent);

      // Activate button behavior (without relying on showTab/event)
      downloadsBtn.addEventListener('click', () => {
        document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
        downloadsContent.classList.add('active');
        document.querySelectorAll('.tabs .tab').forEach(b=>b.classList.remove('active'));
        downloadsBtn.classList.add('active');
      });
    }

    // 4) Inject Display & Refresh + INI Generator inside Graphics tab
    const gfx = document.getElementById('graphics');
    if (gfx && !document.getElementById('bo-ini-card')){
      const card = document.createElement('div');
      card.className = 'glass-card';
      card.id = 'bo-ini-card';
      card.style.marginTop = '1.5rem';
      card.innerHTML = `
        <h3 style="margin-bottom: .5rem;">Display & Refresh — INI Generator</h3>
        <p class="bo-hint">Rileva gli Hz del monitor e genera i file INI per Skyrim AE, Fallout 4, Starfield e Oblivion Remastered.</p>
        <div class="bo-row" style="align-items:center">
          <button class="btn btn-primary" id="bo-detectHz"><span>🖥️</span><span> Rileva Hz</span></button>
          <span id="bo-hzOut" class="badge badge-info" style="padding:.35rem .6rem">—</span>
          <span class="bo-hint" id="bo-userPathHint" style="margin-left:auto"></span>
        </div>
        <div class="grid grid-2" style="margin-top:1rem">
          <div class="glass-card" style="background:var(--glass-bg)">
            <h4>Skyrim AE</h4>
            <pre id="bo-skyrim" style="white-space:pre-wrap"></pre>
            <div class="bo-row">
              <button class="btn btn-secondary" id="bo-dl-skyrim">Scarica SkyrimCustom.ini</button>
              <button class="btn btn-secondary" id="bo-add-skyrim">Aggiungi all'Area</button>
            </div>
            <small class="bo-hint">Percorso tipico: <code id="bo-path-skyrim"></code> <button class="btn btn-secondary" id="bo-copy-skyrim" style="padding:.25rem .5rem">Copia</button></small>
          </div>
          <div class="glass-card" style="background:var(--glass-bg)">
            <h4>Fallout 4</h4>
            <pre id="bo-fo4" style="white-space:pre-wrap"></pre>
            <div class="bo-row">
              <button class="btn btn-secondary" id="bo-dl-fo4">Scarica Fallout4Custom.ini</button>
              <button class="btn btn-secondary" id="bo-add-fo4">Aggiungi all'Area</button>
            </div>
            <small class="bo-hint">Percorso tipico: <code id="bo-path-fo4"></code> <button class="btn btn-secondary" id="bo-copy-fo4" style="padding:.25rem .5rem">Copia</button></small>
          </div>
        </div>
        <div class="grid grid-2" style="margin-top:1rem">
          <div class="glass-card" style="background:var(--glass-bg)">
            <h4>Starfield</h4>
            <pre id="bo-sf" style="white-space:pre-wrap"></pre>
            <div class="bo-row">
              <button class="btn btn-secondary" id="bo-dl-sf">Scarica StarfieldPrefs.ini</button>
              <button class="btn btn-secondary" id="bo-add-sf">Aggiungi all'Area</button>
            </div>
            <small class="bo-hint">Percorso tipico: <code id="bo-path-sf"></code> <button class="btn btn-secondary" id="bo-copy-sf" style="padding:.25rem .5rem">Copia</button></small>
            <div class="bo-hint" style="margin-top:.5rem">Nota: Starfield non ha cap FPS via INI su PC; qui si disattiva il VSync. Usa il limitatore driver/RTSS per un cap preciso.</div>
          </div>
          <div class="glass-card" style="background:var(--glass-bg)">
            <h4>Oblivion Remastered</h4>
            <pre id="bo-obr" style="white-space:pre-wrap"></pre>
            <div class="bo-row">
              <button class="btn btn-secondary" id="bo-dl-obr">Scarica Engine.ini</button>
              <button class="btn btn-secondary" id="bo-add-obr">Aggiungi all'Area</button>
            </div>
            <small class="bo-hint">Percorso tipico: <code id="bo-path-obr"></code> <button class="btn btn-secondary" id="bo-copy-obr" style="padding:.25rem .5rem">Copia</button></small>
          </div>
        </div>
        <div class="bo-hint" style="margin-top:.75rem">
          <strong>Username Windows</strong>: <input id="bo-username" class="form-input" placeholder="Il tuo nome utente Windows" style="max-width:260px; display:inline-block" />
        </div>
      `;
      gfx.querySelector('.section')?.appendChild(card);
    }

    // 5) Downloads logic (Area Download + ZIP)
    const dlState = { items: [] };
    const dlList = () => document.getElementById('bo-list');
    function renderDownloads(){
      const ul = dlList(); if(!ul) return;
      ul.innerHTML='';
      for(const it of dlState.items){
        const li = document.createElement('li');
        li.className='glass-card';
        li.innerHTML = '<div class="bo-row" style="align-items:center; justify-content:space-between">'
          + '<div><strong>'+it.name+'</strong><div class="bo-hint">'+ new Date(it.ts).toLocaleString() +'</div></div>'
          + '<div class="bo-row">'
          + '<button class="btn btn-secondary" data-act="save">Salva</button>'
          + '<button class="btn btn-secondary" data-act="del">Rimuovi</button>'
          + '</div></div>';
        li.querySelector('[data-act="save"]').addEventListener('click',()=>saveBlob(it.name, it.content));
        li.querySelector('[data-act="del"]').addEventListener('click',()=>{ dlState.items = dlState.items.filter(x=>x.ts!==it.ts); renderDownloads(); });
        ul.appendChild(li);
      }
    }
    function addDownload(name, content){ dlState.items.push({name, content, ts: Date.now()}); renderDownloads(); }
    function saveBlob(name, text){ const blob=new Blob([text],{type:'text/plain'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=name; a.click(); URL.revokeObjectURL(a.href); }

    // Minimal ZIP (store only)
    function strToU8(s){ return new TextEncoder().encode(s); }
    function crc32(buf){ let c=~0>>>0; for(let i=0;i<buf.length;i++){ c^=buf[i]; for(let k=0;k<8;k++){ c=(c>>>1)^(0xEDB88320 & (-(c&1))); } } return (~c)>>>0; }
    async function exportZip(){
      const files = dlState.items; if(!files.length) return;
      const chunks=[], central=[]; let offset=0;
      for(const f of files){
        const name=f.name; const data=strToU8(f.content); const crc=crc32(data);
        const h=new DataView(new ArrayBuffer(30));
        h.setUint32(0,0x04034b50,true); h.setUint16(4,20,true); h.setUint16(6,0,true); h.setUint16(8,0,true);
        h.setUint16(10,0,true); h.setUint16(12,0,true); h.setUint32(14,crc,true);
        h.setUint32(18,data.length,true); h.setUint32(22,data.length,true);
        h.setUint16(26,name.length,true); h.setUint16(28,0,true);
        chunks.push(h, strToU8(name), data);
        const c=new DataView(new ArrayBuffer(46));
        c.setUint32(0,0x02014b50,true); c.setUint16(4,20,true); c.setUint16(6,20,true);
        c.setUint16(8,0,true); c.setUint16(10,0,true); c.setUint16(12,0,true);
        c.setUint32(14,crc,true); c.setUint32(18,data.length,true); c.setUint32(22,data.length,true);
        c.setUint16(26,name.length,true); c.setUint16(28,0,true); c.setUint16(30,0,true); c.setUint16(32,0,true); c.setUint16(34,0,true);
        c.setUint32(36,0,true); c.setUint32(40,offset,true);
        central.push(c, strToU8(name));
        offset += 30 + name.length + data.length;
      }
      const centralSize = central.reduce((a,b)=>a+((b.byteLength||b.length)),0);
      const centralOffset = offset;
      const end=new DataView(new ArrayBuffer(22));
      end.setUint32(0,0x06054b50,true); end.setUint16(4,0,true); end.setUint16(6,0,true);
      end.setUint16(8,files.length,true); end.setUint16(10,files.length,true);
      end.setUint32(12,centralSize,true); end.setUint32(16,centralOffset,true); end.setUint16(20,0,true);
      const size=offset+centralSize+22; const out=new Uint8Array(size); let p=0;
      for(const part of chunks){ const arr=part instanceof Uint8Array?part:new Uint8Array(part.buffer); out.set(arr,p); p+=arr.length; }
      for(const part of central){ const arr=part instanceof Uint8Array?part:new Uint8Array(part.buffer); out.set(arr,p); p+=arr.length; }
      out.set(new Uint8Array(end.buffer), p);
      const blob=new Blob([out],{type:'application/zip'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='BethOptimizer_Downloads.zip'; a.click(); URL.revokeObjectURL(a.href);
    }

    // Wire Download tab buttons
    const dlClearBtn = document.getElementById('bo-clear');
    const dlExportBtn = document.getElementById('bo-export');
    if (dlClearBtn) dlClearBtn.addEventListener('click', ()=>{ dlState.items=[]; renderDownloads(); });
    if (dlExportBtn) dlExportBtn.addEventListener('click', exportZip);

    // 6) INI generation + Hz detection
    const hzOut = document.getElementById('bo-hzOut');
    const preSkyrim = document.getElementById('bo-skyrim');
    const preFo4    = document.getElementById('bo-fo4');
    const preSf     = document.getElementById('bo-sf');
    const preObr    = document.getElementById('bo-obr');
    const userHint  = document.getElementById('bo-userPathHint');
    const uInput    = document.getElementById('bo-username');

    function detectUsername(){
      // Try to guess from file:// path (Windows)
      try{
        const p = decodeURIComponent(location.pathname||'');
        const m = p.match(/\/Users\/([^\/\\\\]+)/i);
        if(m && m[1]) return m[1];
      }catch{}
      return '';
    }
    function pathSkyrim(u){ return `C:\\\\Users\\\\${u||'<utente>'}\\\\Documents\\\\My Games\\\\Skyrim Special Edition\\\\SkyrimCustom.ini`; }
    function pathFo4(u){    return `C:\\\\Users\\\\${u||'<utente>'}\\\\Documents\\\\My Games\\\\Fallout4\\\\Fallout4Custom.ini`; }
    function pathSf(u){     return `C:\\\\Users\\\\${u||'<utente>'}\\\\Documents\\\\My Games\\\\Starfield\\\\StarfieldPrefs.ini`; }
    function pathObr(u){    return `C:\\\\Users\\\\${u||'<utente>'}\\\\Documents\\\\My Games\\\\Oblivion Remastered\\\\Saved\\\\Config\\\\Windows\\\\Engine.ini`; }

    const pathEls = {
      skyrim: document.getElementById('bo-path-skyrim'),
      fo4:    document.getElementById('bo-path-fo4'),
      sf:     document.getElementById('bo-path-sf'),
      obr:    document.getElementById('bo-path-obr')
    };

    function updatePaths(u){
      if(pathEls.skyrim) pathEls.skyrim.textContent = pathSkyrim(u);
      if(pathEls.fo4)    pathEls.fo4.textContent    = pathFo4(u);
      if(pathEls.sf)     pathEls.sf.textContent     = pathSf(u);
      if(pathEls.obr)    pathEls.obr.textContent    = pathObr(u);
      if(userHint) userHint.textContent = 'Utente: ' + (u||'<utente>');
    }

    const initUser = detectUsername();
    if(uInput) { uInput.value = initUser; uInput.addEventListener('input', ()=>updatePaths(uInput.value.trim())); }
    updatePaths(initUser);

    function skyrimIni(h){ return ['[Display]','iPresentInterval=0',`fMaxFramerate=${h}.0000`].join('\\n'); }
    function fo4Ini(h){    return ['[Display]','iPresentInterval=0','[General]',`iFPSClamp=${h}`].join('\\n'); }
    function sfPrefs(){    return ['[Display]','bEnableVsync=0'].join('\\n'); }
    function obrIni(h){    return ['[SystemSettings]',`t.MaxFPS=${h}`,'r.VSync=0'].join('\\n'); }

    async function detectHz(durationMs=1500){
      return new Promise((resolve)=>{
        let frames=0; const start=performance.now();
        function tick(t){ frames++; if(t-start>=durationMs){ const elapsed=t-start; resolve(Math.round((frames/elapsed)*1000)); return;} requestAnimationFrame(tick); }
        requestAnimationFrame(tick);
      });
    }
    function nearestCommon(fps){
      const common=[60,75,90,120,144,165,170,175,180,200,240,300,360];
      let best=fps,diff=999;
      for(const v of common){ const d=Math.abs(fps-v); if(d<diff && d<=3){ best=v; diff=d; } }
      return best;
    }

    function updateIni(h){
      if(hzOut) hzOut.textContent = h + ' Hz';
      if(preSkyrim) preSkyrim.textContent = skyrimIni(h);
      if(preFo4)    preFo4.textContent    = fo4Ini(h);
      if(preSf)     preSf.textContent     = sfPrefs();
      if(preObr)    preObr.textContent    = obrIni(h);
    }

    const btnDetect = document.getElementById('bo-detectHz');
    if(btnDetect) btnDetect.addEventListener('click', async()=>{
      if(hzOut) hzOut.textContent = '...';
      const raw = await detectHz();
      const best= nearestCommon(raw);
      updateIni(best);
    });

    // Buttons to download / add
    function wire(btnId, name, getter){
      const btn = document.getElementById(btnId);
      if(!btn) return;
      btn.addEventListener('click', ()=>{
        const text = getter();
        if(btnId.startsWith('bo-dl-')){ saveBlob(name, text); }
        else { addDownload(name, text); }
      });
    }
    wire('bo-dl-skyrim', 'SkyrimCustom.ini', ()=>preSkyrim?.textContent||'');
    wire('bo-add-skyrim','SkyrimCustom.ini', ()=>preSkyrim?.textContent||'');
    wire('bo-dl-fo4', 'Fallout4Custom.ini', ()=>preFo4?.textContent||'');
    wire('bo-add-fo4','Fallout4Custom.ini', ()=>preFo4?.textContent||'');
    wire('bo-dl-sf',  'StarfieldPrefs.ini', ()=>preSf?.textContent||'');
    wire('bo-add-sf', 'StarfieldPrefs.ini', ()=>preSf?.textContent||'');
    wire('bo-dl-obr', 'Engine.ini', ()=>preObr?.textContent||'');
    wire('bo-add-obr','Engine.ini', ()=>preObr?.textContent||'');

    // Copy path buttons
    function copyText(t){ navigator.clipboard && navigator.clipboard.writeText(t); }
    const copyMap = [
      ['bo-copy-skyrim', ()=>pathSkyrim(uInput?.value.trim())],
      ['bo-copy-fo4',    ()=>pathFo4(uInput?.value.trim())],
      ['bo-copy-sf',     ()=>pathSf(uInput?.value.trim())],
      ['bo-copy-obr',    ()=>pathObr(uInput?.value.trim())]
    ];
    copyMap.forEach(([id,get])=>{ const b=document.getElementById(id); if(b) b.addEventListener('click', ()=>copyText(get())); });

    // 7) EULA/Info overlay (30s, close with X or Esc)
    if(!document.getElementById('bo-overlay')){
      const wrap = document.createElement('div');
      wrap.className='bo-overlay';
      wrap.id='bo-overlay';
      wrap.innerHTML = `
        <div class="bo-card" role="dialog" aria-modal="true" aria-labelledby="bo-eula-title">
          <div class="bo-card-h">
            <div>
              <strong id="bo-eula-title">Informazioni & Disclaimer</strong>
              <div class="bo-hint" id="bo-eula-timer">Si chiude automaticamente tra <span class="bo-pill">00:30</span></div>
            </div>
            <button class="bo-x" id="bo-eula-close" title="Chiudi (Esc)">✕</button>
          </div>
          <div class="bo-card-b">
            <p><strong>BethOptimizer</strong> è uno strumento locale, <em>zero‑install</em>, che genera suggerimenti e file INI per Skyrim AE, Fallout 4, Starfield e Oblivion Remastered.</p>
            <ul style="margin:.75rem 0 .5rem 1.2rem">
              <li><strong>Nessuna garanzia:</strong> software fornito “così com’è”.</li>
              <li><strong>Nessuna responsabilità:</strong> nessuna responsabilità per danni o perdite.</li>
              <li><strong>Uso personale:</strong> non commerciale salvo accordi scritti.</li>
              <li><strong>Limitazioni tecniche:</strong> usa l’Area Download per salvare e poi copia nelle cartelle di gioco.</li>
            </ul>
            <p>Puoi chiudere subito con ✕ o premendo <kbd>Esc</kbd>. In ogni caso si chiuderà da sola entro 30 secondi.</p>
          </div>
        </div>`;
      document.body.appendChild(wrap);

      function fmt(s){ const m=String(Math.floor(s/60)).padStart(2,'0'); const ss=String(s%60).padStart(2,'0'); return m+':'+ss; }
      let left=30;
      const pill = wrap.querySelector('.bo-pill');
      const timerEl = document.getElementById('bo-eula-timer');
      const tick = setInterval(()=>{ left--; if(left<=0){ close(); } else { if(pill) pill.textContent = fmt(left); } }, 1000);
      function close(){ clearInterval(tick); wrap.remove(); }
      document.getElementById('bo-eula-close').addEventListener('click', close);
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') close(); }, { once:true });
    }
  });
})();
</script>


<script>
// --- Add TikTok link (darkplayer84tv) alongside existing social icons ---
document.addEventListener('DOMContentLoaded', () => {
  const TIKTOK_URL = "https://tiktok.com/@darkplayer84tv";

  // Try to locate the social icons container by finding the YouTube icon and using its parent
  const yt = document.querySelector('a[aria-label="YouTube"]');
  const container = yt ? yt.parentElement : null;

  function makeTikTokAnchor(example){
    const a = document.createElement('a');
    a.href = TIKTOK_URL;
    a.setAttribute('aria-label','TikTok');
    a.target = '_blank';
    a.rel = 'noopener noreferrer';
    a.title = 'TikTok';
    // Try to mirror classes from an existing social icon for consistent styling
    if (example && example.className) a.className = example.className;
    // Fallback content if no icon font is available
    a.innerHTML = a.innerHTML || '<span style="font-weight:700">TikTok</span>';
    return a;
  }

  // Insert into header/social bar if found
  if (container) {
    const tiktokA = makeTikTokAnchor(yt);
    // Avoid duplicates
    if (!container.querySelector('a[aria-label="TikTok"]')) {
      container.appendChild(tiktokA);
    }
  } else {
    // As a fallback, add to the end of body in a subtle corner if no social bar found
    if (!document.querySelector('.bo-float-tiktok')) {
      const wrap = document.createElement('div');
      wrap.className = 'bo-float-tiktok';
      wrap.style.cssText = 'position:fixed;right:10px;bottom:10px;z-index:9999;opacity:.8';
      const a = makeTikTokAnchor(null);
      a.style.cssText = 'padding:.35rem .6rem;border-radius:.6rem;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.15);color:inherit;text-decoration:none';
      wrap.appendChild(a);
      document.body.appendChild(wrap);
    }
  }
});
</script>


<script>
// ===== Write-to-disk + Hz override integration =====
document.addEventListener('DOMContentLoaded', () => {
  // 1) Inject UI controls into the existing INI card
  const iniCard = document.getElementById('bo-ini-card');
  const hzRow = iniCard ? iniCard.querySelector('.bo-row') : null; // first row with detectHz/hzOut
  if (iniCard && hzRow) {
    // Manual Hz override controls
    const lbl = document.createElement('label');
    lbl.textContent = 'Override Hz:';
    lbl.className = 'bo-hint';
    lbl.style.marginLeft = '8px';

    const input = document.createElement('input');
    input.type = 'number';
    input.id = 'bo-overrideHz';
    input.min = '30';
    input.max = '360';
    input.step = '1';
    input.className = 'form-input';
    input.style.cssText = 'width:90px;display:inline-block;margin-left:6px';

    const apply = document.createElement('button');
    apply.id = 'bo-applyHz';
    apply.className = 'btn btn-secondary';
    apply.style.marginLeft = '6px';
    apply.textContent = 'Applica';

    // Insert before the userPathHint if present (keeps layout clean)
    const userHint = document.getElementById('bo-userPathHint');
    hzRow.insertBefore(lbl, userHint || null);
    hzRow.insertBefore(input, userHint || null);
    hzRow.insertBefore(apply, userHint || null);

    // Write buttons (under username hint, at end of card)
    const writeWrap = document.createElement('div');
    writeWrap.className = 'bo-row';
    writeWrap.style.cssText = 'margin-top:10px;align-items:center;justify-content:flex-start';

    const pickBtn = document.createElement('button');
    pickBtn.id = 'bo-pickMyGames';
    pickBtn.className = 'btn btn-primary';
    pickBtn.textContent = 'Scegli cartella "My Games"';

    const writeBtn = document.createElement('button');
    writeBtn.id = 'bo-writeAll';
    writeBtn.className = 'btn btn-secondary';
    writeBtn.textContent = 'Scrivi i file nei percorsi';

    const tip = document.createElement('span');
    tip.className = 'bo-hint';
    tip.style.marginLeft = '8px';
    tip.textContent = 'Salva diretto nelle cartelle (serve selezionare la cartella My Games).';

    writeWrap.appendChild(pickBtn);
    writeWrap.appendChild(writeBtn);
    writeWrap.appendChild(tip);
    iniCard.appendChild(writeWrap);

    // 2) Logic: Hz override -> update INI
    function updateIni(h){
      const hzOut = document.getElementById('bo-hzOut');
      const preSkyrim = document.getElementById('bo-skyrim');
      const preFo4    = document.getElementById('bo-fo4');
      const preSf     = document.getElementById('bo-sf');
      const preObr    = document.getElementById('bo-obr');
      if (hzOut) hzOut.textContent = h + ' Hz';
      if (preSkyrim) preSkyrim.textContent = ['[Display]','iPresentInterval=0',`fMaxFramerate=${h}.0000`].join('\n');
      if (preFo4)    preFo4.textContent    = ['[Display]','iPresentInterval=0','[General]',`iFPSClamp=${h}`].join('\n');
      if (preSf)     preSf.textContent     = ['[Display]','bEnableVsync=0'].join('\n');
      if (preObr)    preObr.textContent    = ['[SystemSettings]',`t.MaxFPS=${h}`,'r.VSync=0'].join('\n');
    }

    apply.addEventListener('click', () => {
      const v = parseInt(input.value, 10);
      if (isNaN(v) || v < 30 || v > 360) {
        alert('Inserisci un valore Hz compreso tra 30 e 360.');
        return;
      }
      updateIni(v);
    });
    input.addEventListener('keydown', (e)=>{ if (e.key === 'Enter') apply.click(); });

    // 3) File System Access API: pick dir + write files
    let myGamesDirHandle = null;

    function apiSupported(){
      return (!!window.showDirectoryPicker) && (!!window.isSecureContext || location.protocol === 'file:');
    }

    async function pickMyGames() {
      if (!apiSupported()) {
        alert('Il tuo browser non consente la scrittura diretta (serve Chrome/Edge e contesto sicuro o file://). Usa l’Area Download.');
        return;
      }
      try {
        myGamesDirHandle = await showDirectoryPicker({ id: 'bo-mygames', mode: 'readwrite' });
        alert('Cartella collegata. Ora posso scrivere gli INI direttamente lì dentro.');
      } catch(e) {
        console.warn('pickMyGames aborted/error:', e);
      }
    }

    async function ensureDir(baseHandle, parts) {
      let dir = baseHandle;
      for (const p of parts) {
        if (!p) continue;
        dir = await dir.getDirectoryHandle(p, { create: true });
      }
      return dir;
    }

    async function writeTextFile(dirHandle, filename, text) {
      // Create/overwrite file, but first write .bak if existing
      let bakData = null;
      try {
        const fh = await dirHandle.getFileHandle(filename);
        const f = await fh.getFile();
        bakData = await f.text();
      } catch(e) { /* no previous */ }

      if (bakData != null) {
        const bakHandle = await dirHandle.getFileHandle(filename + '.bak', { create: true });
        const bw = await bakHandle.createWritable();
        await bw.write(bakData);
        await bw.close();
      }
      const fileHandle = await dirHandle.getFileHandle(filename, { create: true });
      const w = await fileHandle.createWritable();
      await w.write((text || '').replace(/\r?\n/g, '\r\n'));
      await w.close();
    }

    async function writeAllIni() {
      if (!myGamesDirHandle) { alert('Seleziona prima la cartella "My Games".'); return; }
      const preSkyrim = document.getElementById('bo-skyrim')?.textContent || '';
      const preFo4    = document.getElementById('bo-fo4')?.textContent || '';
      const preSf     = document.getElementById('bo-sf')?.textContent || '';
      const preObr    = document.getElementById('bo-obr')?.textContent || '';

      // Minimal validation
      if (!preSkyrim && !preFo4 && !preSf && !preObr) {
        alert('Genera prima i file (Rileva Hz o inserisci Override Hz).');
        return;
      }

      // Skyrim AE
      let dir = await ensureDir(myGamesDirHandle, ['Skyrim Special Edition']);
      await writeTextFile(dir, 'SkyrimCustom.ini', preSkyrim);

      // Fallout 4
      dir = await ensureDir(myGamesDirHandle, ['Fallout4']);
      await writeTextFile(dir, 'Fallout4Custom.ini', preFo4);

      // Starfield
      dir = await ensureDir(myGamesDirHandle, ['Starfield']);
      await writeTextFile(dir, 'StarfieldPrefs.ini', preSf);

      // Oblivion Remastered
      dir = await ensureDir(myGamesDirHandle, ['Oblivion Remastered','Saved','Config','Windows']);
      await writeTextFile(dir, 'Engine.ini', preObr);

      alert('Completato. File scritti nelle cartelle dei giochi.');
    }

    // Wire buttons
    document.getElementById('bo-pickMyGames')?.addEventListener('click', pickMyGames);
    document.getElementById('bo-writeAll')?.addEventListener('click', writeAllIni);

    // If API unsupported, disable buttons for clarity
    if (!apiSupported()) {
      const b1 = document.getElementById('bo-pickMyGames');
      const b2 = document.getElementById('bo-writeAll');
      if (b1) { b1.disabled = true; b1.title = 'Non supportato dal browser: usa l’Area Download'; }
      if (b2) { b2.disabled = true; b2.title = 'Non supportato dal browser: usa l’Area Download'; }
    }
  }
});
</script>


<!-- ===== Hardware Scan (Open-Source DB) ===== -->
<section id="bo-hwscan" class="section" style="margin-top:1.5rem">
  <h2 class="section-title"><span>🔎</span><span> Hardware Scan (Open‑Source DB)</span></h2>
  <div class="glass-card">
    <div class="bo-row" style="align-items:center">
      <button id="bo-db-load" class="btn btn-primary">Scarica database (PCI/USB IDs)</button>
      <span id="bo-db-status" class="bo-hint">Non caricato</span>
    </div>

    <div class="divider" style="margin:10px 0"></div>

    <h4>Rilevamento GPU automatico</h4>
    <div class="bo-row" style="align-items:center">
      <button id="bo-gpu-scan" class="btn btn-secondary">Scansiona GPU (WebGL/WebGPU)</button>
      <span id="bo-gpu-info" class="bo-hint">—</span>
    </div>

    <div class="divider" style="margin:10px 0"></div>

    <h4>Ricerca per ID hardware</h4>
    <p class="bo-hint">Incolla un ID da Gestione Dispositivi (esempi: <code>PCI\\VEN_10DE&DEV_2484</code> o <code>USB\\VID_1A2B&PID_3C4D</code>), poi premi Cerca.</p>
    <div class="bo-row" style="align-items:center">
      <input id="bo-hw-id" class="form-input" placeholder="PCI\\VEN_xxxx&DEV_xxxx  oppure  USB\\VID_xxxx&PID_xxxx" style="min-width:360px" />
      <button id="bo-hw-lookup" class="btn btn-secondary">Cerca</button>
    </div>
    <pre id="bo-hw-result" class="log" style="margin-top:.75rem; white-space:pre-wrap"></pre>
    <p class="bo-hint">Fonti: <a href="https://pci-ids.ucw.cz/" target="_blank" rel="noopener">PCI ID Repository</a>, <a href="https://www.linux-usb.org/usb-ids.html" target="_blank" rel="noopener">USB ID Repository</a>.</p>
  </div>
</section>

<!-- ===== Quick Scan (descrizione) ===== -->
<section id="bo-quickscan" class="section" style="margin-top:1.5rem">
  <h2 class="section-title"><span>⚡</span><span> Scansione Rapida (ambiente browser)</span></h2>
  <div class="glass-card">
    <p class="bo-hint">
      Questa scansione legge solo dati esposti dal browser (user agent, lingua, viewport, Hz stimato) e <strong>non</strong> accede all'hardware a basso livello.
      Per rilevare modelli esatti usa la sezione “Hardware Scan (Open‑Source DB)”.
    </p>
  </div>
</section>


<script>
(function(){
  const PCI_URL = "https://raw.githubusercontent.com/pciutils/pciids/master/pci.ids";
  const USB_URL = "https://raw.githubusercontent.com/gowdy/usbids/master/usb.ids";
  const DB_KEY = "bo_hwdb_v1";

  function $(q){ return document.querySelector(q); }
  function logResult(msg){ const el=$("#bo-hw-result"); if(el) el.textContent = (msg||'').trim() || '—'; }
  function setDbStatus(txt){ const el=$("#bo-db-status"); if(el) el.textContent = txt; }

  // --- Load & cache databases ---
  async function fetchText(url){
    const res = await fetch(url, { cache:'no-store' });
    if(!res.ok) throw new Error("HTTP "+res.status);
    return await res.text();
  }

  function parsePCI(text){
    // Minimal parser: vendor lines "vvvv  Vendor", device lines "\tdddd  Device".
    const vendors = {}; // { vendorIdHex: { name, devices: { deviceIdHex: name } } }
    let currentVendor = null;
    const lines = text.split(/\r?\n/);
    for(const raw of lines){
      const line = raw.replace(/\t/g,'\t'); // keep tabs
      if(!line || line.startsWith('#')) continue;
      if(line[0] !== '\t'){
        const m = line.match(/^([0-9a-fA-F]{4})\s+(.*)$/);
        if(m){ currentVendor = m[1].toLowerCase(); vendors[currentVendor] = vendors[currentVendor] || { name:m[2], devices:{} }; }
      } else if(line.startsWith('\t') && !line.startsWith('\t\t') && currentVendor){
        const m = line.match(/^\t([0-9a-fA-F]{4})\s+(.*)$/);
        if(m){ vendors[currentVendor].devices[m[1].toLowerCase()] = m[2]; }
      }
    }
    return { vendors };
  }

  function parseUSB(text){
    // Vendor lines "vvvv  Vendor", product lines "\tpppp  Product"
    const vendors = {};
    let currentVendor = null;
    const lines = text.split(/\r?\n/);
    for(const raw of lines){
      const line = raw;
      if(!line || line.startsWith('#')) continue;
      if(line[0] !== '\t'){
        const m = line.match(/^([0-9a-fA-F]{4})\s+(.*)$/);
        if(m){ currentVendor = m[1].toLowerCase(); vendors[currentVendor] = vendors[currentVendor] || { name:m[2], products:{} }; }
      } else if(line.startsWith('\t') && !line.startsWith('\t\t') && currentVendor){
        const m = line.match(/^\t([0-9a-fA-F]{4})\s+(.*)$/);
        if(m){ vendors[currentVendor].products[m[1].toLowerCase()] = m[2]; }
      }
    }
    return { vendors };
  }

  async function loadDatabases(){
    setDbStatus("Caricamento…");
    try {
      const [pciTxt, usbTxt] = await Promise.all([fetchText(PCI_URL), fetchText(USB_URL)]);
      const pci = parsePCI(pciTxt);
      const usb = parseUSB(usbTxt);
      const payload = { ts: Date.now(), pci, usb };
      localStorage.setItem(DB_KEY, JSON.stringify(payload));
      setDbStatus("Caricato (cache locale)");
      return payload;
    } catch(e){
      console.error("DB load error", e);
      setDbStatus("Errore caricamento");
      throw e;
    }
  }

  function getDatabases(){
    try{
      const raw = localStorage.getItem(DB_KEY);
      if(!raw) return null;
      return JSON.parse(raw);
    }catch{ return null; }
  }

  // --- Hardware ID parsing + lookup ---
  function parseHardwareId(s){
    if(!s) return null;
    s = s.trim();
    // PCI\VEN_10DE&DEV_2484&SUBSYS...
    let m = s.match(/VEN[_:]?([0-9A-Fa-f]{4}).*?DEV[_:]?([0-9A-Fa-f]{4})/);
    if(m) return { kind:'pci', ven:m[1].toLowerCase(), dev:m[2].toLowerCase() };
    // USB\VID_1A2B&PID_3C4D
    m = s.match(/VID[_:]?([0-9A-Fa-f]{4}).*?PID[_:]?([0-9A-Fa-f]{4})/);
    if(m) return { kind:'usb', ven:m[1].toLowerCase(), dev:m[2].toLowerCase() };
    return null;
  }

  function lookupId(db, id){
    if(!db || !id) return "Database non caricato.";
    if(id.kind === 'pci'){
      const v = db.pci?.vendors?.[id.ven];
      if(!v) return `PCI VEN_${id.ven.toUpperCase()}: sconosciuto`;
      const dname = v.devices?.[id.dev];
      return `PCI VEN_${id.ven.toUpperCase()} (${v.name}) / DEV_${id.dev.toUpperCase()}${dname?` (${dname})`:""}`;
    } else {
      const v = db.usb?.vendors?.[id.ven];
      if(!v) return `USB VID_${id.ven.toUpperCase()}: sconosciuto`;
      const pname = v.products?.[id.dev];
      return `USB VID_${id.ven.toUpperCase()} (${v.name}) / PID_${id.dev.toUpperCase()}${pname?` (${pname})`:""}`;
    }
  }

  // --- GPU detect via WebGL/WebGPU ---
  async function detectGPU(){
    let source = null;
    let name = null;
    // Try WebGPU first (if available)
    try{
      if (navigator.gpu && navigator.gpu.requestAdapter){
        const adapter = await navigator.gpu.requestAdapter();
        if (adapter && adapter.name){
          name = adapter.name;
          source = "WebGPU adapter.name";
        }
      }
    }catch(e){ /* ignore */ }

    if(!name){
      try{
        const canvas = document.createElement('canvas');
        const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
        if (gl){
          const ext = gl.getExtension('WEBGL_debug_renderer_info');
          if (ext){
            name = gl.getParameter(ext.UNMASKED_RENDERER_WEBGL) || gl.getParameter(ext.UNMASKED_VENDOR_WEBGL);
            source = "WebGL debug renderer";
          } else {
            name = gl.getParameter(gl.RENDERER) || gl.getParameter(gl.VENDOR);
            source = "WebGL renderer";
          }
        }
      }catch(e){ /* ignore */ }
    }
    return { name: name||'—', source: source||'—' };
  }

  function vendorFromName(str){
    const s = (str||'').toLowerCase();
    if (s.includes('nvidia')) return 'NVIDIA';
    if (s.includes('advanced micro devices') || s.includes('amd') || s.includes('ati')) return 'AMD';
    if (s.includes('intel')) return 'Intel';
    if (s.includes('qualcomm') || s.includes('adreno')) return 'Qualcomm (Adreno)';
    if (s.includes('apple')) return 'Apple';
    return 'Sconosciuto';
  }

  // Wire UI
  document.addEventListener('DOMContentLoaded', ()=>{
    $('#bo-db-load')?.addEventListener('click', async()=>{
      try { await loadDatabases(); } catch{}
    });

    $('#bo-gpu-scan')?.addEventListener('click', async()=>{
      const info = await detectGPU();
      const vendor = vendorFromName(info.name);
      const out = `GPU: ${info.name}\nVendor: ${vendor}\nFonte: ${info.source}`;
      const el=$("#bo-gpu-info"); if(el) el.textContent = `${vendor} — ${info.name}`;
      logResult(out + "\n\nSuggerimento: se vuoi validare con certezza modello/ID, incolla l'ID PCI dalla Gestione Dispositivi sopra.");
    });

    $('#bo-hw-lookup')?.addEventListener('click', ()=>{
      const id = parseHardwareId($('#bo-hw-id')?.value||'');
      if(!id){ logResult("Formato ID non riconosciuto. Esempi validi:\n- PCI\\VEN_10DE&DEV_2484\n- USB\\VID_1A2B&PID_3C4D"); return; }
      const db = getDatabases();
      if(!db){ logResult("Database non caricato. Premi “Scarica database (PCI/USB IDs)”."); return; }
      logResult( lookupId(db, id) );
    });

    // Show cached status
    const cached = getDatabases();
    if(cached){ setDbStatus("Caricato (cache locale)"); }
  });
})();
</script>

</body>
</html>